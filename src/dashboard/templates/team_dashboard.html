{% extends "detail_page.html" %}

{% block title %}{{ team_display_name }} - Dashboard{% endblock %}
{% block page_title %}{{ team_display_name }} - Dashboard{% endblock %}

{% block header_title %}{{ team_display_name }}{% endblock %}

{% block page_description %}
<div class="page-description">
    Comprehensive Team Performance Analytics
</div>
{% endblock %}

{% block period_info %}
{% if date_range_info and date_range_info.get('description') %}
ðŸ“Š Viewing: {{ date_range_info.get('description') }}
{% else %}
ðŸ“Š Team metrics: Last {{ days_back }} days | ðŸ‘¤ Person metrics: Last 90 days
{% endif %}
{% endblock %}

{% block team_menu_items %}
<li><a href="/team/{{ team_name }}/compare">ðŸ‘¥ Compare Members</a></li>
{% endblock %}

{% block breadcrumb_items %}
<a href="/team/{{ team_name }}">{{ team_display_name }}</a>
{% endblock %}

{% block main_content %}
<div class="team-dashboard-container">

<h2 style="margin: 30px 0 15px 0;">GitHub Metrics</h2>
        <div class="metrics-grid">
            <div class="card">
                <h2>Pull Requests</h2>
                <p class="helper-text">
                    Total pull requests created by team members during this period. Represents code contributions and feature development activity.
                </p>
                <div class="metric-value">{{ team_data.github.pr_count }}</div>
                <div class="metric-label">Total PRs</div>
            </div>
            <div class="card">
                <h2>Code Reviews</h2>
                <p class="helper-text">
                    Total reviews given by team members on pull requests. High review participation improves code quality and knowledge sharing.
                </p>
                <div class="metric-value">{{ team_data.github.review_count }}</div>
                <div class="metric-label">Total Reviews</div>
            </div>
            <div class="card">
                <h2>Commits</h2>
                <p class="helper-text">
                    Total commits pushed by team members. Measures overall development activity and code change volume.
                </p>
                <div class="metric-value">{{ team_data.github.commit_count }}</div>
                <div class="metric-label">Total Commits</div>
            </div>
            <div class="card">
                <h2>Avg Cycle Time</h2>
                <p class="helper-text">
                    Average time from PR creation to merge across all team PRs. Lower times indicate efficient review processes and faster delivery.
                </p>
                <div class="metric-value">{{ "%.1f"|format(team_data.github.avg_cycle_time) }}h</div>
                <div class="metric-label">PR Merge Time</div>
            </div>
        </div>

        <div class="card">
            <h2>Team Member Activity</h2>
            <p class="helper-text">
                Individual contribution breakdown showing PRs, reviews, commits, and code changes for each team member during this period.
            </p>
            <div class="member-grid">
                {% for username, stats in team_data.github.member_trends.items() %}
                {% set display_name = member_names.get(username, username) %}
                <div class="member-card">
                    <div class="member-name">
                        <a href="/person/{{ username }}" class="person-link">{{ display_name }}</a>
                        <div class="text-sm" style="color: var(--text-secondary); margin-top: 4px;">@{{ username }}</div>
                    </div>
                    <div class="member-stats">
                        PRs: {{ stats.prs }} | Reviews: {{ stats.reviews }}<br>
                        Commits: {{ stats.commits }}<br>
                        Lines: +{{ stats.lines_added }} -{{ stats.lines_deleted }}<br>
                        {% if stats.jira %}
                        Jira: {{ stats.jira.completed }} done | {{ stats.jira.in_progress }} WIP
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        {% if team_data.dora %}
        <h2 style="margin: 40px 0 15px 0;">ðŸš€ DORA Metrics</h2>
        <p class="helper-text" style="margin-bottom: 20px;">
            DevOps Research and Assessment (DORA) four key metrics measure elite software delivery performance.
            <a href="https://dora.dev/" target="_blank" style="color: var(--primary-color);">Learn more</a>
        </p>

        <div class="metrics-grid">
            <!-- Deployment Frequency Card -->
            <div class="card metric-card">
                <h3>Deployment Frequency</h3>
                <p class="helper-text">How often code is deployed to production</p>
                <div class="metric-value">{{ team_data.dora.deployment_frequency.per_week|round(1) }}</div>
                <div class="metric-label">Deployments per Week</div>
                <div class="metric-badge {{ team_data.dora.deployment_frequency.badge_class }}">
                    {{ team_data.dora.deployment_frequency.level|capitalize }}
                </div>
                <div class="metric-details">
                    Total: {{ team_data.dora.deployment_frequency.total_deployments }} production releases
                </div>
            </div>

            <!-- Lead Time Card -->
            <div class="card metric-card">
                <h3>Lead Time for Changes</h3>
                <p class="helper-text">Time from PR merge to production</p>
                {% if team_data.dora.lead_time.median_days is not none %}
                <div class="metric-value">{{ team_data.dora.lead_time.median_days|round(1) }}</div>
                <div class="metric-label">Days (Median)</div>
                <div class="metric-badge {{ team_data.dora.lead_time.badge_class }}">
                    {{ team_data.dora.lead_time.level|capitalize }}
                </div>
                <div class="metric-details">
                    p95: {{ team_data.dora.lead_time.p95_days|round(1) }} days | Sample: {{ team_data.dora.lead_time.sample_size }} PRs
                </div>
                {% else %}
                <div class="metric-value">â€”</div>
                <div class="metric-label">No Data</div>
                <div class="metric-details">No PRs mapped to deployments</div>
                {% endif %}
            </div>

            <!-- Change Failure Rate Card -->
            <div class="card metric-card">
                <h3>Change Failure Rate</h3>
                <p class="helper-text">% of deployments causing incidents</p>
                {% if team_data.dora.change_failure_rate.rate_percent is not none %}
                <div class="metric-value">{{ team_data.dora.change_failure_rate.rate_percent|round(1) }}%</div>
                <div class="metric-label">Failed Deployments</div>
                <div class="metric-badge {{ team_data.dora.change_failure_rate.badge_class }}">
                    {{ team_data.dora.change_failure_rate.level|capitalize }}
                </div>
                <div class="metric-details">
                    {{ team_data.dora.change_failure_rate.failed_deployments }} / {{ team_data.dora.change_failure_rate.total_deployments }} deployments
                </div>
                {% else %}
                <div class="metric-value">â€”</div>
                <div class="metric-label">{{ team_data.dora.change_failure_rate.get('note', 'No Data') }}</div>
                <div class="metric-details">
                    {{ team_data.dora.change_failure_rate.total_deployments }} deployments tracked
                </div>
                {% endif %}
            </div>

            <!-- MTTR Card -->
            <div class="card metric-card">
                <h3>Mean Time to Restore</h3>
                <p class="helper-text">Time to recover from incidents</p>
                {% if team_data.dora.mttr.median_days is not none %}
                <div class="metric-value">{{ team_data.dora.mttr.median_days|round(1) }}</div>
                <div class="metric-label">Days (Median)</div>
                <div class="metric-badge {{ team_data.dora.mttr.badge_class }}">
                    {{ team_data.dora.mttr.level|capitalize }}
                </div>
                <div class="metric-details">
                    p95: {{ team_data.dora.mttr.p95_days|round(1) }} days | Sample: {{ team_data.dora.mttr.sample_size }} incidents
                </div>
                {% else %}
                <div class="metric-value">â€”</div>
                <div class="metric-label">{{ team_data.dora.mttr.get('note', 'No Data') }}</div>
                <div class="metric-details">Incident tracking not configured</div>
                {% endif %}
            </div>
        </div>

        <!-- DORA Performance Level Card -->
        <div class="card dora-performance-card">
            <h3>Overall DORA Performance Level</h3>
            <div class="dora-level-badge {{ team_data.dora.dora_level.level|lower }}">
                {{ team_data.dora.dora_level.level }}
            </div>
            <p class="helper-text" style="margin-top: 15px;">
                {{ team_data.dora.dora_level.description }}
            </p>
            <div class="dora-breakdown">
                <strong>Metric Breakdown:</strong>
                Elite: {{ team_data.dora.dora_level.breakdown.elite }} |
                High: {{ team_data.dora.dora_level.breakdown.high }} |
                Medium: {{ team_data.dora.dora_level.breakdown.medium }} |
                Low: {{ team_data.dora.dora_level.breakdown.low }}
            </div>
        </div>

        <!-- Deployment Frequency Trend Chart -->
        {% if team_data.dora.deployment_frequency.trend %}
        <div class="card chart-card">
            <h3>Deployment Frequency Trend</h3>
            <p class="helper-text">Weekly production deployment volume over time</p>
            <div id="deployment-trend-chart"></div>
            <script>
                const deploymentTrendData = {{ team_data.dora.deployment_frequency.trend|tojson }};
                const weeks = Object.keys(deploymentTrendData).sort();
                const counts = weeks.map(week => deploymentTrendData[week]);

                const deploymentTrace = {
                    x: weeks,
                    y: counts,
                    type: 'bar',
                    name: 'Deployments',
                    marker: {
                        color: CHART_COLORS.PRS
                    }
                };

                const layout = {
                    ...getChartLayout(),
                    xaxis: { title: 'Week' },
                    yaxis: { title: 'Deployments' },
                    showlegend: false
                };

                Plotly.newPlot('deployment-trend-chart', [deploymentTrace], layout, {responsive: true});
            </script>
        </div>
        {% endif %}
        {% endif %}

        {% if team_data.jira %}
        <h2 style="margin: 40px 0 15px 0;">Jira Metrics</h2>

        {% if team_data.jira.throughput %}
        <div class="metrics-grid">
            <div class="card">
                <h2>
                    Throughput (12 weeks)
                    {% if team_config and team_config.get('jira', {}).get('filters', {}).get('completed_12weeks') %}
                    <a href="{{ jira_server }}/issues/?filter={{ team_config.jira.filters.completed_12weeks }}"
                       target="_blank"
                       class="jira-filter-link">
                        ðŸ”— View Filter
                    </a>
                    {% endif %}
                </h2>
                <p class="helper-text">
                    Average issues completed per week over the last 12 weeks. Measures team velocity and delivery rate.
                </p>
                <div class="metric-value">{{ "%.1f"|format(team_data.jira.throughput.weekly_avg) }}</div>
                <div class="metric-label">Issues per week</div>
                <div style="margin-top: 10px; font-size: 14px; color: #7f8c8d;">
                    Total completed: {{ team_data.jira.throughput.total_completed }}
                </div>
            </div>

            {% if team_data.jira.wip %}
            <div class="card">
                <h2>
                    Work In Progress
                    {% if team_config and team_config.get('jira', {}).get('filters', {}).get('wip') %}
                    <a href="{{ jira_server }}/issues/?filter={{ team_config.jira.filters.wip }}"
                       target="_blank"
                       class="jira-filter-link">
                        ðŸ”— View Filter
                    </a>
                    {% endif %}
                </h2>
                <p class="helper-text">
                    Current number of issues actively being worked on. Lower WIP counts and ages generally lead to faster completion.
                </p>
                <div class="metric-value">{{ team_data.jira.wip.count }}</div>
                <div class="metric-label">WIP Items</div>
                <div style="margin-top: 10px; font-size: 14px; color: #7f8c8d;">
                    Avg age: {{ "%.1f"|format(team_data.jira.wip.avg_age_days) }} days
                </div>
            </div>
            {% endif %}

            {% if team_data.jira.flagged %}
            <div class="card">
                <h2>
                    Flagged/Blocked
                    {% if team_config and team_config.get('jira', {}).get('filters', {}).get('flagged_blocked') %}
                    <a href="{{ jira_server }}/issues/?filter={{ team_config.jira.filters.flagged_blocked }}"
                       target="_blank"
                       class="bug-filter-link">
                        ðŸ”— View Filter
                    </a>
                    {% endif %}
                </h2>
                <p class="helper-text">
                    Issues marked as blocked or flagged. These items need attention to remove impediments and maintain flow.
                </p>
                <div class="metric-value {% if team_data.jira.flagged.count > 0 %}attention{% endif %}">
                    {{ team_data.jira.flagged.count }}
                </div>
                <div class="metric-label">Blocked Issues</div>
            </div>
            {% endif %}

            {% if team_data.jira.bugs %}
            <div class="card">
                <h2>
                    Bugs (Created / Resolved)
                    {% if team_config and team_config.get('jira', {}).get('filters', {}).get('bugs') %}
                    <a href="{{ jira_server }}/issues/?filter={{ team_config.jira.filters.bugs }}"
                       target="_blank"
                       class="jira-filter-link">
                        ðŸ”— View Filter
                    </a>
                    {% endif %}
                </h2>
                <p class="helper-text">
                    Bug tickets created vs resolved. A negative net difference (more resolved than created) indicates improving product quality.
                </p>
                <div class="metric-value">{{ team_data.jira.bugs.created }} / {{ team_data.jira.bugs.resolved }}</div>
                <div class="metric-label">Created / Resolved</div>
                <div style="margin-top: 10px; font-size: 14px; color: {% if team_data.jira.bugs.net > 0 %}#e74c3c{% else %}#27ae60{% endif %};">
                    Net: {% if team_data.jira.bugs.net > 0 %}+{% endif %}{{ team_data.jira.bugs.net }}
                </div>
            </div>
            {% endif %}
        </div>

        {% if team_data.jira.throughput and team_data.jira.throughput.by_type %}
        <div class="card">
            <h2>Throughput by Issue Type</h2>
            <p class="helper-text">
                Distribution of completed work by issue type over 12 weeks. Shows what types of work the team delivers (features, bugs, tasks, etc.).
            </p>
            <div id="throughput-types-chart" style="height: 400px;"></div>
            <script>
                (function() {
                const typeData = {{ team_data.jira.throughput.by_type | tojson }};
                const colors = getChartColors();

                Plotly.newPlot('throughput-types-chart', [{
                    labels: Object.keys(typeData),
                    values: Object.values(typeData),
                    type: 'pie',
                    marker: {
                        colors: ['#3498db', '#e74c3c', '#2ecc71', '#f39c12', '#9b59b6', '#1abc9c', '#e67e22']
                    },
                    textinfo: 'label+percent',
                    textposition: 'outside'
                }], {
                    paper_bgcolor: colors.paper_bgcolor,
                    font: {color: colors.font_color},
                    showlegend: true,
                    height: 400
                }, {responsive: true});
                })();
            </script>
        </div>
        {% endif %}

        {% endif %}

        {% if team_data.jira.wip and team_data.jira.wip.age_distribution %}
        <div class="card">
            <h2>WIP Age Distribution</h2>
            <p class="helper-text">
                How long current WIP items have been in progress. Items in WIP longer may need attention or indicate blockers.
            </p>
            <div id="wip-chart"></div>
            <script>
                var data = [{
                    x: Object.keys({{ team_data.jira.wip.age_distribution|tojson }}),
                    y: Object.values({{ team_data.jira.wip.age_distribution|tojson }}),
                    type: 'bar',
                    marker: {color: '#3498db'}
                }];
                // Get theme-aware colors
                const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
                const chartColors = {
                    paper_bgcolor: isDark ? '#2d2d2d' : '#ffffff',
                    plot_bgcolor: isDark ? '#2d2d2d' : '#ffffff',
                    font_color: isDark ? '#e0e0e0' : '#2c3e50',
                    grid_color: isDark ? '#444' : '#ecf0f1'
                };

                var layout = {
                    title: 'Days in WIP Status',
                    xaxis: {
                        title: 'Age Range',
                        gridcolor: chartColors.grid_color,
                        color: chartColors.font_color
                    },
                    yaxis: {
                        title: 'Number of Issues',
                        gridcolor: chartColors.grid_color,
                        color: chartColors.font_color
                    },
                    paper_bgcolor: chartColors.paper_bgcolor,
                    plot_bgcolor: chartColors.plot_bgcolor,
                    font: {color: chartColors.font_color},
                    height: 300
                };
                Plotly.newPlot('wip-chart', data, layout);
            </script>
        </div>
        {% endif %}

        {% if team_data.jira.wip and team_data.jira.wip.by_status %}
        <div class="card">
            <h2>WIP Items by Status</h2>
            <p class="helper-text">
                Breakdown of current work in progress by status. Helps identify bottlenecks if work piles up in specific statuses.
            </p>
            <div id="wip-status-chart" style="height: 400px;"></div>
            <script>
                (function() {
                const statusData = {{ team_data.jira.wip.by_status | tojson }};
                const colors = getChartColors();

                Plotly.newPlot('wip-status-chart', [{
                    x: Object.values(statusData),
                    y: Object.keys(statusData),
                    type: 'bar',
                    orientation: 'h',
                    marker: {color: '#3498db'}
                }], {
                    paper_bgcolor: colors.paper_bgcolor,
                    plot_bgcolor: colors.plot_bgcolor,
                    font: {color: colors.font_color},
                    xaxis: {
                        title: 'Number of Issues',
                        gridcolor: colors.grid_color,
                        color: colors.font_color
                    },
                    yaxis: {
                        title: '',
                        gridcolor: colors.grid_color,
                        color: colors.font_color
                    },
                    height: 400,
                    margin: {l: 180, r: 30, t: 30, b: 50}
                }, {responsive: true});
                })();
            </script>
        </div>
        {% endif %}

        {% if team_data.jira.bugs %}
        <div class="card">
            <h2>Bugs: Created vs Resolved{% if date_range_info %} ({{ date_range_info.get('description', 'Last 90 Days') }}){% else %} (Last 90 Days){% endif %}</h2>
            <p class="helper-text">
                Top: Bug creation vs resolution trends. Bottom: Net difference (created minus resolved). Positive net trends indicate bug backlog growth.
            </p>
            {% if team_data.jira.bugs.trend_created %}
            <div id="bugs-trend-chart" style="height: 600px;"></div>
            <script>
                (function() {
                const bugsCreated = {{ team_data.jira.bugs.trend_created | tojson }};
                const bugsResolved = {{ team_data.jira.bugs.trend_resolved | tojson }};
                const colors = getChartColors();

                // Merge weeks from both datasets
                const allWeeks = [...new Set([...Object.keys(bugsCreated), ...Object.keys(bugsResolved)])].sort();

                // Calculate net difference (Created - Resolved)
                const netDifference = allWeeks.map(w => (bugsCreated[w] || 0) - (bugsResolved[w] || 0));

                Plotly.newPlot('bugs-trend-chart', [
                    {
                        x: allWeeks,
                        y: allWeeks.map(w => bugsCreated[w] || 0),
                        type: 'scatter',
                        mode: 'lines+markers',
                        name: 'Created',
                        line: {color: CHART_COLORS.CREATED, width: 2},
                        marker: {color: CHART_COLORS.CREATED, size: 6},
                        xaxis: 'x',
                        yaxis: 'y'
                    },
                    {
                        x: allWeeks,
                        y: allWeeks.map(w => bugsResolved[w] || 0),
                        type: 'scatter',
                        mode: 'lines+markers',
                        name: 'Resolved',
                        line: {color: CHART_COLORS.RESOLVED, width: 2},
                        marker: {color: CHART_COLORS.RESOLVED, size: 6},
                        xaxis: 'x',
                        yaxis: 'y'
                    },
                    {
                        x: allWeeks,
                        y: netDifference,
                        type: 'scatter',
                        mode: 'lines+markers',
                        name: 'Net (Created - Resolved)',
                        line: {color: CHART_COLORS.NET, width: 2},
                        marker: {color: CHART_COLORS.NET, size: 6},
                        xaxis: 'x2',
                        yaxis: 'y2'
                    }
                ], {
                    paper_bgcolor: colors.paper_bgcolor,
                    plot_bgcolor: colors.plot_bgcolor,
                    font: {color: colors.font_color},
                    grid: {rows: 2, columns: 1, pattern: 'independent', roworder: 'top to bottom'},
                    xaxis: {
                        title: '',
                        gridcolor: colors.grid_color,
                        color: colors.font_color,
                        showticklabels: false
                    },
                    yaxis: {
                        title: 'Count',
                        gridcolor: colors.grid_color,
                        color: colors.font_color
                    },
                    xaxis2: {
                        title: 'Week',
                        gridcolor: colors.grid_color,
                        color: colors.font_color,
                        anchor: 'y2'
                    },
                    yaxis2: {
                        title: 'Net Difference',
                        gridcolor: colors.grid_color,
                        color: colors.font_color
                    },
                    showlegend: true,
                    height: 600,
                    legend: {
                        x: 0.5,
                        xanchor: 'center',
                        y: 1.02,
                        yanchor: 'bottom',
                        orientation: 'h'
                    }
                }, {responsive: true});
                })();
            </script>
            {% else %}
            <div style="padding: 40px; text-align: center; color: #7f8c8d; font-style: italic;">
                No bug trend data available for the last 90 days
            </div>
            {% endif %}
        </div>
        {% endif %}

        {% if team_data.jira.scope %}
        <div class="card">
            <h2>Scope: Created vs Resolved{% if date_range_info %} ({{ date_range_info.get('description', 'Last 90 Days') }}){% else %} (Last 90 Days){% endif %}</h2>
            <p class="helper-text">
                Top: Scope item creation vs completion. Bottom: Net difference. Shows whether scope is growing or being worked down.
            </p>
            {% if team_data.jira.scope.trend_created %}
            <div id="scope-trend-chart" style="height: 600px;"></div>
            <script>
                (function() {
                const scopeCreated = {{ team_data.jira.scope.trend_created | tojson }};
                const scopeResolved = {{ team_data.jira.scope.trend_resolved | tojson }};
                const colors = getChartColors();

                const allWeeksScope = [...new Set([...Object.keys(scopeCreated), ...Object.keys(scopeResolved)])].sort();

                // Calculate net difference (Created - Resolved)
                const netDifferenceScope = allWeeksScope.map(w => (scopeCreated[w] || 0) - (scopeResolved[w] || 0));

                Plotly.newPlot('scope-trend-chart', [
                    {
                        x: allWeeksScope,
                        y: allWeeksScope.map(w => scopeCreated[w] || 0),
                        type: 'scatter',
                        mode: 'lines+markers',
                        name: 'Created',
                        line: {color: CHART_COLORS.CREATED, width: 2},
                        marker: {color: CHART_COLORS.CREATED, size: 6},
                        xaxis: 'x',
                        yaxis: 'y'
                    },
                    {
                        x: allWeeksScope,
                        y: allWeeksScope.map(w => scopeResolved[w] || 0),
                        type: 'scatter',
                        mode: 'lines+markers',
                        name: 'Resolved',
                        line: {color: CHART_COLORS.RESOLVED, width: 2},
                        marker: {color: CHART_COLORS.RESOLVED, size: 6},
                        xaxis: 'x',
                        yaxis: 'y'
                    },
                    {
                        x: allWeeksScope,
                        y: netDifferenceScope,
                        type: 'scatter',
                        mode: 'lines+markers',
                        name: 'Net (Created - Resolved)',
                        line: {color: CHART_COLORS.NET, width: 2},
                        marker: {color: CHART_COLORS.NET, size: 6},
                        xaxis: 'x2',
                        yaxis: 'y2'
                    }
                ], {
                    paper_bgcolor: colors.paper_bgcolor,
                    plot_bgcolor: colors.plot_bgcolor,
                    font: {color: colors.font_color},
                    grid: {rows: 2, columns: 1, pattern: 'independent', roworder: 'top to bottom'},
                    xaxis: {
                        title: '',
                        gridcolor: colors.grid_color,
                        color: colors.font_color,
                        showticklabels: false
                    },
                    yaxis: {
                        title: 'Count',
                        gridcolor: colors.grid_color,
                        color: colors.font_color
                    },
                    xaxis2: {
                        title: 'Week',
                        gridcolor: colors.grid_color,
                        color: colors.font_color,
                        anchor: 'y2'
                    },
                    yaxis2: {
                        title: 'Net Difference',
                        gridcolor: colors.grid_color,
                        color: colors.font_color
                    },
                    showlegend: true,
                    height: 600,
                    legend: {
                        x: 0.5,
                        xanchor: 'center',
                        y: 1.02,
                        yanchor: 'bottom',
                        orientation: 'h'
                    }
                }, {responsive: true});
                })();
            </script>
            {% else %}
            <div style="padding: 40px; text-align: center; color: #7f8c8d; font-style: italic;">
                No scope trend data available for the last 90 days
            </div>
            {% endif %}
        </div>
        {% endif %}

        {% if team_data.jira.flagged and team_data.jira.flagged.issues %}
        <div class="card">
            <h2>
                Flagged/Blocked Issues
                {% if team_config and team_config.get('jira', {}).get('filters', {}).get('flagged_blocked') %}
                <a href="{{ jira_server }}/issues/?filter={{ team_config.jira.filters.flagged_blocked }}"
                   target="_blank"
                   class="bug-filter-link">
                    ðŸ”— View in Jira
                </a>
                {% endif %}
            </h2>
            <p class="helper-text">
                Issues currently flagged or blocked, with assignee and days blocked. Prioritize removing blockers to maintain team flow.
            </p>
            <table>
                <thead>
                    <tr>
                        <th>Issue</th>
                        <th>Summary</th>
                        <th>Assignee</th>
                        <th>Days Blocked</th>
                    </tr>
                </thead>
                <tbody>
                    {% for issue in team_data.jira.flagged.issues %}
                    <tr>
                        <td>
                            <strong>
                                <a href="{{ jira_server }}/browse/{{ issue.key }}"
                                   target="_blank"
                                   class="jira-filter-link">
                                    {{ issue.key }} ðŸ”—
                                </a>
                            </strong>
                        </td>
                        <td>{{ issue.summary[:60] }}...</td>
                        <td>{{ issue.assignee }}</td>
                        <td class="attention">{{ issue.days_blocked }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}
        {% endif %}
    </div>

</div> <!-- End of team-dashboard-container -->
{% endblock %}

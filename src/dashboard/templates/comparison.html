<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Comparison</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <script src="{{ url_for('static', filename='js/theme-toggle.js') }}"></script>
    <style>
        /* Additional comparison-specific styles if needed */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }

        /* Add spacing after GitHub Metrics table */
        .card:has(table) {
            margin-bottom: 30px;
        }

        /* Chart container sizing */
        .comparison-grid {
            margin-bottom: 30px;
        }

        .comparison-grid .card {
            min-width: 0;
            overflow: hidden;
            padding: 20px;
            margin-bottom: 10px;
        }

        .comparison-grid .card h2 {
            margin-top: 0;
            margin-bottom: 15px;
        }

        .comparison-grid .card > div[id$="-comparison"] {
            width: 100%;
            max-width: 600px;
            height: 400px;
            margin: 0 auto;
        }

        /* Responsive design for smaller screens */
        @media (max-width: 1200px) {
            .comparison-grid { grid-template-columns: 1fr; }
        }

        @media (max-width: 768px) {
            .card { padding: 15px; }
            h1 { font-size: 1.8em; }
            .nav a { display: block; margin: 10px 0; }
        }
        th, td {
            text-align: left;
            padding: 12px;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-primary);
        }
        th {
            background: var(--bg-tertiary);
            font-weight: 600;
        }
        .team-native { color: var(--accent-primary); font-weight: 600; }
        .team-webtc { color: var(--accent-secondary); font-weight: 600; }
        .winner {
            background: var(--success);
            color: white;
        }
    </style>
</head>
<body>
    <button onclick="toggleTheme()" class="theme-toggle">üåô Dark Mode</button>
    <div class="container">
        <header>
            <h1>Team Comparison</h1>
            <p class="subtitle">Last updated: {{ updated_at.strftime('%Y-%m-%d %H:%M:%S') }}</p>
            <p class="subtitle" style="margin-top: 8px;">
                üìÖ Team Metrics: Last {{ days_back }} days | üë§ Person Metrics: Last 365 days
            </p>
            <div class="nav">
                <a href="/">‚Üê Home</a>
                <a href="/team/Native">Native Team</a>
                <a href="/team/WebTC">WebTC Team</a>
            </div>
        </header>

        <div class="card">
            <h2>GitHub Metrics Comparison</h2>
            <p style="font-size: 13px; color: var(--text-secondary, #7f8c8d); margin: 8px 0 15px 0; line-height: 1.4;">
                Side-by-side comparison of GitHub activity metrics between teams. The winning team for each metric is highlighted in green.
            </p>
            <table>
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th class="team-native">Native</th>
                        <th class="team-webtc">WebTC</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Pull Requests</strong></td>
                        <td {% if comparison.Native.prs > comparison.WebTC.prs %}class="winner"{% endif %}>
                            {{ comparison.Native.prs }}
                        </td>
                        <td {% if comparison.WebTC.prs > comparison.Native.prs %}class="winner"{% endif %}>
                            {{ comparison.WebTC.prs }}
                        </td>
                    </tr>
                    <tr>
                        <td><strong>Code Reviews</strong></td>
                        <td {% if comparison.Native.reviews > comparison.WebTC.reviews %}class="winner"{% endif %}>
                            {{ comparison.Native.reviews }}
                        </td>
                        <td {% if comparison.WebTC.reviews > comparison.Native.reviews %}class="winner"{% endif %}>
                            {{ comparison.WebTC.reviews }}
                        </td>
                    </tr>
                    <tr>
                        <td><strong>Commits</strong></td>
                        <td {% if comparison.Native.commits > comparison.WebTC.commits %}class="winner"{% endif %}>
                            {{ comparison.Native.commits }}
                        </td>
                        <td {% if comparison.WebTC.commits > comparison.Native.commits %}class="winner"{% endif %}>
                            {{ comparison.WebTC.commits }}
                        </td>
                    </tr>
                    <tr>
                        <td><strong>Avg PR Cycle Time</strong></td>
                        <td {% if comparison.Native.avg_cycle_time < comparison.WebTC.avg_cycle_time and comparison.Native.avg_cycle_time > 0 %}class="winner"{% endif %}>
                            {{ "%.1f"|format(comparison.Native.avg_cycle_time) }}h
                        </td>
                        <td {% if comparison.WebTC.avg_cycle_time < comparison.Native.avg_cycle_time and comparison.WebTC.avg_cycle_time > 0 %}class="winner"{% endif %}>
                            {{ "%.1f"|format(comparison.WebTC.avg_cycle_time) }}h
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <h2 style="margin: 30px 0 15px 0; font-size: 20px;">Visual Comparison</h2>
        <p style="font-size: 13px; color: var(--text-secondary, #7f8c8d); margin: 0 0 20px 0; line-height: 1.4;">
            Visual comparison of team performance across key GitHub metrics. Charts show relative volumes and efficiency between teams.
        </p>

        <div class="comparison-grid">
            <div class="card">
                <h2>Pull Requests</h2>
                <div id="pr-comparison"></div>
            </div>

            <div class="card">
                <h2>Code Reviews</h2>
                <div id="review-comparison"></div>
            </div>

            <div class="card">
                <h2>Commits</h2>
                <div id="commit-comparison"></div>
            </div>

            <div class="card">
                <h2>PR Cycle Time</h2>
                <div id="cycle-time-comparison"></div>
            </div>
        </div>

        <script>
            // Get theme-aware colors
            function getChartColors() {
                const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
                return {
                    paper_bgcolor: isDark ? '#2d2d2d' : '#ffffff',
                    plot_bgcolor: isDark ? '#2d2d2d' : '#ffffff',
                    font_color: isDark ? '#e0e0e0' : '#2c3e50',
                    grid_color: isDark ? '#444' : '#ecf0f1'
                };
            }

            // Common layout configuration
            function getChartLayout(title, yaxisTitle) {
                const colors = getChartColors();
                return {
                    title: {
                        text: title,
                        font: {size: 14}
                    },
                    yaxis: {
                        title: yaxisTitle,
                        gridcolor: colors.grid_color,
                        color: colors.font_color,
                        showticklabels: true,
                        tickfont: {size: 11}
                    },
                    xaxis: {
                        color: colors.font_color,
                        showticklabels: true,
                        tickfont: {size: 11},
                        tickangle: -45
                    },
                    paper_bgcolor: colors.paper_bgcolor,
                    plot_bgcolor: colors.plot_bgcolor,
                    font: {color: colors.font_color, size: 11},
                    width: 600,
                    height: 400,
                    margin: {l: 60, r: 30, t: 50, b: 100},
                    autosize: false
                };
            }

            // Common config
            const config = {responsive: false, displayModeBar: false};

            // PR Chart
            Plotly.newPlot('pr-comparison', [{
                x: ['Native', 'WebTC'],
                y: [{{ comparison.Native.prs }}, {{ comparison.WebTC.prs }}],
                type: 'bar',
                marker: {color: ['#3498db', '#9b59b6']},
                width: [0.4, 0.4]
            }], getChartLayout('Pull Requests by Team', 'Number of PRs'), config);

            // Review Chart
            Plotly.newPlot('review-comparison', [{
                x: ['Native', 'WebTC'],
                y: [{{ comparison.Native.reviews }}, {{ comparison.WebTC.reviews }}],
                type: 'bar',
                marker: {color: ['#3498db', '#9b59b6']},
                width: [0.4, 0.4]
            }], getChartLayout('Reviews by Team', 'Number of Reviews'), config);

            // Commits Chart
            Plotly.newPlot('commit-comparison', [{
                x: ['Native', 'WebTC'],
                y: [{{ comparison.Native.commits }}, {{ comparison.WebTC.commits }}],
                type: 'bar',
                marker: {color: ['#3498db', '#9b59b6']},
                width: [0.4, 0.4]
            }], getChartLayout('Commits by Team', 'Number of Commits'), config);

            // Cycle Time Chart
            Plotly.newPlot('cycle-time-comparison', [{
                x: ['Native', 'WebTC'],
                y: [{{ comparison.Native.avg_cycle_time }}, {{ comparison.WebTC.avg_cycle_time }}],
                type: 'bar',
                marker: {color: ['#3498db', '#9b59b6']},
                width: [0.4, 0.4]
            }], getChartLayout('Avg PR Cycle Time (Lower is Better)', 'Hours'), config);
        </script>

        {% if comparison.Native.jira_throughput or comparison.WebTC.jira_throughput %}
        <div class="card">
            <h2>Jira Metrics Comparison</h2>
            <p style="font-size: 13px; color: var(--text-secondary, #7f8c8d); margin: 8px 0 15px 0; line-height: 1.4;">
                Side-by-side comparison of Jira delivery metrics between teams. Higher throughput and lower WIP generally indicate better flow.
            </p>
            <table>
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th class="team-native">Native</th>
                        <th class="team-webtc">WebTC</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Throughput (issues/week)</strong></td>
                        <td {% if comparison.Native.jira_throughput > comparison.WebTC.jira_throughput %}class="winner"{% endif %}>
                            <a href="{{ jira_server }}/issues/?filter={{ team_configs['Native'].jira.filters.completed_12weeks }}"
                               target="_blank"
                               style="color: inherit; text-decoration: underline;">
                                {{ "%.1f"|format(comparison.Native.jira_throughput) }}
                            </a>
                        </td>
                        <td {% if comparison.WebTC.jira_throughput > comparison.Native.jira_throughput %}class="winner"{% endif %}>
                            <a href="{{ jira_server }}/issues/?filter={{ team_configs['WebTC'].jira.filters.completed_12weeks }}"
                               target="_blank"
                               style="color: inherit; text-decoration: underline;">
                                {{ "%.1f"|format(comparison.WebTC.jira_throughput) }}
                            </a>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>WIP Count</strong></td>
                        <td>
                            <a href="{{ jira_server }}/issues/?filter={{ team_configs['Native'].jira.filters.wip }}"
                               target="_blank"
                               style="color: inherit; text-decoration: underline;">
                                {{ comparison.Native.jira_wip }}
                            </a>
                        </td>
                        <td>
                            <a href="{{ jira_server }}/issues/?filter={{ team_configs['WebTC'].jira.filters.wip }}"
                               target="_blank"
                               style="color: inherit; text-decoration: underline;">
                                {{ comparison.WebTC.jira_wip }}
                            </a>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>Flagged/Blocked</strong></td>
                        <td {% if comparison.Native.jira_flagged < comparison.WebTC.jira_flagged %}class="winner"{% endif %}>
                            <a href="{{ jira_server }}/issues/?filter={{ team_configs['Native'].jira.filters.flagged_blocked }}"
                               target="_blank"
                               style="color: inherit; text-decoration: underline;">
                                {{ comparison.Native.jira_flagged }}
                            </a>
                        </td>
                        <td {% if comparison.WebTC.jira_flagged < comparison.Native.jira_flagged %}class="winner"{% endif %}>
                            <a href="{{ jira_server }}/issues/?filter={{ team_configs['WebTC'].jira.filters.flagged_blocked }}"
                               target="_blank"
                               style="color: inherit; text-decoration: underline;">
                                {{ comparison.WebTC.jira_flagged }}
                            </a>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        {% endif %}
    </div>
</body>
</html>

{% extends "detail_page.html" %}

{% block title %}Team Comparison{% endblock %}
{% block page_title %}Team Comparison{% endblock %}

{% block header_title %}Team Comparison{% endblock %}

{% block page_description %}
<div class="page-description">
    Cross-Team Performance Analysis
</div>
{% endblock %}

{% block data_freshness %}
{% if updated_at %}
<div style="text-align: center; margin-top: 5px; margin-bottom: 15px;">
    <span style="display: inline-block; padding: 4px 12px; background: var(--bg-tertiary); color: var(--text-secondary); border-radius: 12px; font-size: 0.85em; border: 1px solid var(--border-color);">
        üìÖ Data from {{ updated_at|time_ago }}
    </span>
</div>
{% endif %}
{% endblock %}

{% block period_info %}
üìä Comparing last {{ config.days_back if config else 90 }} days
{% endblock %}

{% block breadcrumb_items %}
<a href="/comparison">Team Comparison</a>
{% endblock %}

{% block main_content %}
<div class="comparison-container">

<!-- Export Buttons -->
<div class="export-buttons">
    <a href="/api/export/comparison/csv" class="btn-export" download>
        üìä Export CSV
    </a>
    <a href="/api/export/comparison/json" class="btn-export" download>
        üìã Export JSON
    </a>
</div>

<!-- Overall Performance Score Card -->
<div class="card" style="background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%); margin-bottom: 30px;">
    <h2 style="margin-bottom: 20px;">üèÜ Overall Performance</h2>
    <p class="helper-text" style="margin: 0 0 20px 0;">
        Composite performance scores normalized per team member. Teams are ranked by their average individual performance across all metrics.
    </p>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 20px;">
        {% for team_name, team_data in comparison.items() %}
        <div style="background: var(--bg-secondary); padding: 20px; border-radius: 8px; text-align: center; {% if team_data.score == comparison.values()|map(attribute='score')|max %}border: 3px solid var(--success);{% else %}border: 2px solid var(--border-color);{% endif %}">
            <div class="display-md" style="font-weight: 600; color: var(--text-primary); margin-bottom: 10px;">
                {{ team_name }}
            </div>
            <div class="text-sm" style="color: var(--text-secondary); margin-bottom: 10px;">
                {{ team_data.team_size }} members
            </div>
            <div class="display-xl" style="font-weight: 700; color: var(--accent-primary); margin: 15px 0;">
                {{ team_data.score }}
            </div>
            <div class="text-sm" style="color: var(--text-secondary); margin-bottom: 15px;">Performance Score (per member)</div>
            <div class="display-sm" style="color: var(--success); font-weight: 600;">
                {{ team_wins.get(team_name, 0) }} metric wins
            </div>
            {% if team_data.score == comparison.values()|map(attribute='score')|max %}
            <div style="margin-top: 10px; font-size: 1.5em;">üëë</div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
</div>

<!-- Overall Performance Radar Chart -->
<div class="card">
    <h2>Performance Overview</h2>
    <p class="helper-text">
        Comprehensive view of all metrics across teams. Larger area indicates better overall performance.
    </p>
    <div id="radar-comparison" style="height: 500px;"></div>
</div>

<div class="card">
            <h2>GitHub Metrics Comparison</h2>
            <p class="helper-text">
                Side-by-side comparison of GitHub activity metrics between teams. The winning team for each metric is highlighted in green.
            </p>
            <table>
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th class="team-native">Native</th>
                        <th class="team-webtc">WebTC</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Pull Requests</strong></td>
                        <td {% if comparison.Native.prs > comparison.WebTC.prs %}class="winner"{% endif %}>
                            {{ comparison.Native.prs }}
                        </td>
                        <td {% if comparison.WebTC.prs > comparison.Native.prs %}class="winner"{% endif %}>
                            {{ comparison.WebTC.prs }}
                        </td>
                    </tr>
                    <tr>
                        <td><strong>Code Reviews</strong></td>
                        <td {% if comparison.Native.reviews > comparison.WebTC.reviews %}class="winner"{% endif %}>
                            {{ comparison.Native.reviews }}
                        </td>
                        <td {% if comparison.WebTC.reviews > comparison.Native.reviews %}class="winner"{% endif %}>
                            {{ comparison.WebTC.reviews }}
                        </td>
                    </tr>
                    <tr>
                        <td><strong>Commits</strong></td>
                        <td {% if comparison.Native.commits > comparison.WebTC.commits %}class="winner"{% endif %}>
                            {{ comparison.Native.commits }}
                        </td>
                        <td {% if comparison.WebTC.commits > comparison.Native.commits %}class="winner"{% endif %}>
                            {{ comparison.WebTC.commits }}
                        </td>
                    </tr>
                    <tr>
                        <td><strong>Avg PR Cycle Time</strong></td>
                        <td {% if comparison.Native.avg_cycle_time < comparison.WebTC.avg_cycle_time and comparison.Native.avg_cycle_time > 0 %}class="winner"{% endif %}>
                            {{ "%.1f"|format(comparison.Native.avg_cycle_time) }}h
                        </td>
                        <td {% if comparison.WebTC.avg_cycle_time < comparison.Native.avg_cycle_time and comparison.WebTC.avg_cycle_time > 0 %}class="winner"{% endif %}>
                            {{ "%.1f"|format(comparison.WebTC.avg_cycle_time) }}h
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <h2 style="margin: 30px 0 15px 0;">Visual Comparison</h2>
        <p class="helper-text" style="margin: 0 0 20px 0;">
            Visual comparison of team performance across key GitHub metrics. Charts show relative volumes and efficiency between teams.
        </p>

        <div class="comparison-grid">
            <div class="card">
                <h2>Pull Requests</h2>
                <div id="pr-comparison"></div>
            </div>

            <div class="card">
                <h2>Code Reviews</h2>
                <div id="review-comparison"></div>
            </div>

            <div class="card">
                <h2>Commits</h2>
                <div id="commit-comparison"></div>
            </div>

            <div class="card">
                <h2>PR Cycle Time</h2>
                <div id="cycle-time-comparison"></div>
            </div>
        </div>

        <script>
            // Get theme-aware colors
            function getChartColors() {
                const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
                return {
                    paper_bgcolor: isDark ? '#2d2d2d' : '#ffffff',
                    plot_bgcolor: isDark ? '#2d2d2d' : '#ffffff',
                    font_color: isDark ? '#e0e0e0' : '#2c3e50',
                    grid_color: isDark ? '#444' : '#ecf0f1'
                };
            }

            // Common layout configuration
            function getChartLayout(title, yaxisTitle) {
                const colors = getChartColors();
                return {
                    title: {
                        text: title,
                        font: {size: 14}
                    },
                    yaxis: {
                        title: yaxisTitle,
                        gridcolor: colors.grid_color,
                        color: colors.font_color,
                        showticklabels: true,
                        tickfont: {size: 11}
                    },
                    xaxis: {
                        color: colors.font_color,
                        showticklabels: true,
                        tickfont: {size: 11},
                        tickangle: -45
                    },
                    paper_bgcolor: colors.paper_bgcolor,
                    plot_bgcolor: colors.plot_bgcolor,
                    font: {color: colors.font_color, size: 11},
                    width: 600,
                    height: 400,
                    margin: {l: 60, r: 30, t: 50, b: 100},
                    autosize: false
                };
            }

            // Common config
            const config = {responsive: false, displayModeBar: false};

            // Radar Chart - Overall Performance
            (function() {
                const colors = getChartColors();

                // Normalize metrics to 0-100 scale for fair comparison
                const teams = {{ comparison.keys() | list | tojson }};
                const teamData = {{ comparison | tojson }};

                // Get min/max for each metric
                const prs = teams.map(t => teamData[t].prs);
                const reviews = teams.map(t => teamData[t].reviews);
                const commits = teams.map(t => teamData[t].commits);
                const cycleTimes = teams.map(t => teamData[t].avg_cycle_time).filter(v => v > 0);
                const throughputs = teams.map(t => teamData[t].jira_throughput);
                // DORA metrics
                const deployFreqs = teams.map(t => teamData[t].dora_deployment_freq || 0).filter(v => v > 0);
                const leadTimes = teams.map(t => teamData[t].dora_lead_time || 0).filter(v => v > 0);
                const cfrs = teams.map(t => teamData[t].dora_cfr || 0).filter(v => v > 0);
                const mttrs = teams.map(t => teamData[t].dora_mttr || 0).filter(v => v > 0);

                function normalize(value, min, max) {
                    if (max === min) return 50;
                    return ((value - min) / (max - min)) * 100;
                }

                const traces = teams.map((teamName, idx) => {
                    const team = teamData[teamName];
                    const prScore = normalize(team.prs, Math.min(...prs), Math.max(...prs));
                    const reviewScore = normalize(team.reviews, Math.min(...reviews), Math.max(...reviews));
                    const commitScore = normalize(team.commits, Math.min(...commits), Math.max(...commits));
                    // For cycle time, lower is better, so invert
                    const cycleScore = cycleTimes.length > 0 && team.avg_cycle_time > 0
                        ? 100 - normalize(team.avg_cycle_time, Math.min(...cycleTimes), Math.max(...cycleTimes))
                        : 50;
                    const throughputScore = normalize(team.jira_throughput, Math.min(...throughputs), Math.max(...throughputs));

                    // DORA metrics scores (with None handling)
                    const deployFreqScore = deployFreqs.length > 0 && team.dora_deployment_freq
                        ? normalize(team.dora_deployment_freq, Math.min(...deployFreqs), Math.max(...deployFreqs))
                        : null;
                    const leadTimeScore = leadTimes.length > 0 && team.dora_lead_time
                        ? 100 - normalize(team.dora_lead_time, Math.min(...leadTimes), Math.max(...leadTimes))  // Inverted
                        : null;
                    const cfrScore = cfrs.length > 0 && team.dora_cfr
                        ? 100 - normalize(team.dora_cfr, Math.min(...cfrs), Math.max(...cfrs))  // Inverted
                        : null;
                    const mttrScore = mttrs.length > 0 && team.dora_mttr
                        ? 100 - normalize(team.dora_mttr, Math.min(...mttrs), Math.max(...mttrs))  // Inverted
                        : null;

                    // Build r and theta arrays dynamically based on available metrics
                    const r = [prScore, reviewScore, commitScore, cycleScore, throughputScore];
                    const theta = ['PRs', 'Reviews', 'Commits', 'Cycle Time', 'Jira'];

                    if (deployFreqScore !== null) {
                        r.push(deployFreqScore);
                        theta.push('Deploy Freq');
                    }
                    if (leadTimeScore !== null) {
                        r.push(leadTimeScore);
                        theta.push('Lead Time');
                    }
                    if (cfrScore !== null) {
                        r.push(cfrScore);
                        theta.push('CFR');
                    }
                    if (mttrScore !== null) {
                        r.push(mttrScore);
                        theta.push('MTTR');
                    }

                    return {
                        type: 'scatterpolar',
                        r: r,
                        theta: theta,
                        fill: 'toself',
                        name: teamName,
                        marker: {color: idx === 0 ? '#3498db' : '#9b59b6'},
                        line: {color: idx === 0 ? '#3498db' : '#9b59b6'}
                    };
                });

                const radarLayout = {
                    polar: {
                        radialaxis: {
                            visible: true,
                            range: [0, 100],
                            gridcolor: colors.grid_color,
                            color: colors.font_color
                        },
                        angularaxis: {
                            gridcolor: colors.grid_color,
                            color: colors.font_color
                        }
                    },
                    paper_bgcolor: colors.paper_bgcolor,
                    plot_bgcolor: colors.plot_bgcolor,
                    font: {color: colors.font_color, size: 12},
                    showlegend: true,
                    legend: {
                        x: 0.5,
                        xanchor: 'center',
                        y: -0.1,
                        yanchor: 'top',
                        orientation: 'h'
                    },
                    height: 500
                };

                Plotly.newPlot('radar-comparison', traces, radarLayout, {responsive: true});
            })();

            // PR Chart
            Plotly.newPlot('pr-comparison', [{
                x: ['Native', 'WebTC'],
                y: [{{ comparison.Native.prs }}, {{ comparison.WebTC.prs }}],
                type: 'bar',
                marker: {color: ['#3498db', '#9b59b6']},
                width: [0.4, 0.4]
            }], getChartLayout('Pull Requests by Team', 'Number of PRs'), config);

            // Review Chart
            Plotly.newPlot('review-comparison', [{
                x: ['Native', 'WebTC'],
                y: [{{ comparison.Native.reviews }}, {{ comparison.WebTC.reviews }}],
                type: 'bar',
                marker: {color: ['#3498db', '#9b59b6']},
                width: [0.4, 0.4]
            }], getChartLayout('Reviews by Team', 'Number of Reviews'), config);

            // Commits Chart
            Plotly.newPlot('commit-comparison', [{
                x: ['Native', 'WebTC'],
                y: [{{ comparison.Native.commits }}, {{ comparison.WebTC.commits }}],
                type: 'bar',
                marker: {color: ['#3498db', '#9b59b6']},
                width: [0.4, 0.4]
            }], getChartLayout('Commits by Team', 'Number of Commits'), config);

            // Cycle Time Chart
            Plotly.newPlot('cycle-time-comparison', [{
                x: ['Native', 'WebTC'],
                y: [{{ comparison.Native.avg_cycle_time }}, {{ comparison.WebTC.avg_cycle_time }}],
                type: 'bar',
                marker: {color: ['#3498db', '#9b59b6']},
                width: [0.4, 0.4]
            }], getChartLayout('Avg PR Cycle Time (Lower is Better)', 'Hours'), config);
        </script>

        {% if comparison.Native.jira_throughput or comparison.WebTC.jira_throughput %}
        <div class="card">
            <h2>Jira Metrics Comparison</h2>
            <p class="helper-text">
                Side-by-side comparison of Jira delivery metrics between teams. Higher throughput and lower WIP generally indicate better flow.
            </p>
            <table>
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th class="team-native">Native</th>
                        <th class="team-webtc">WebTC</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Throughput (issues/week)</strong></td>
                        <td {% if comparison.Native.jira_throughput > comparison.WebTC.jira_throughput %}class="winner"{% endif %}>
                            <a href="{{ jira_server }}/issues/?filter={{ team_configs['Native'].jira.filters.completed }}"
                               target="_blank"
                               class="jira-filter-link"
                               style="color: inherit;">
                                {{ "%.1f"|format(comparison.Native.jira_throughput) }}
                            </a>
                        </td>
                        <td {% if comparison.WebTC.jira_throughput > comparison.Native.jira_throughput %}class="winner"{% endif %}>
                            <a href="{{ jira_server }}/issues/?filter={{ team_configs['WebTC'].jira.filters.completed }}"
                               target="_blank"
                               class="jira-filter-link"
                               style="color: inherit;">
                                {{ "%.1f"|format(comparison.WebTC.jira_throughput) }}
                            </a>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>WIP Count</strong></td>
                        <td {% if comparison.Native.jira_wip < comparison.WebTC.jira_wip %}class="winner"{% endif %}>
                            <a href="{{ jira_server }}/issues/?filter={{ team_configs['Native'].jira.filters.wip }}"
                               target="_blank"
                               class="jira-filter-link"
                               style="color: inherit;">
                                {{ comparison.Native.jira_wip }}
                            </a>
                        </td>
                        <td {% if comparison.WebTC.jira_wip < comparison.Native.jira_wip %}class="winner"{% endif %}>
                            <a href="{{ jira_server }}/issues/?filter={{ team_configs['WebTC'].jira.filters.wip }}"
                               target="_blank"
                               class="jira-filter-link"
                               style="color: inherit;">
                                {{ comparison.WebTC.jira_wip }}
                            </a>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>Flagged/Blocked</strong></td>
                        <td {% if comparison.Native.jira_flagged < comparison.WebTC.jira_flagged %}class="winner"{% endif %}>
                            <a href="{{ jira_server }}/issues/?filter={{ team_configs['Native'].jira.filters.flagged_blocked }}"
                               target="_blank"
                               class="bug-filter-link"
                               style="color: inherit;">
                                {{ comparison.Native.jira_flagged }}
                            </a>
                        </td>
                        <td {% if comparison.WebTC.jira_flagged < comparison.Native.jira_flagged %}class="winner"{% endif %}>
                            <a href="{{ jira_server }}/issues/?filter={{ team_configs['WebTC'].jira.filters.flagged_blocked }}"
                               target="_blank"
                               class="bug-filter-link"
                               style="color: inherit;">
                                {{ comparison.WebTC.jira_flagged }}
                            </a>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        {% endif %}

        <!-- DORA Metrics Comparison -->
        {% if comparison.Native.get('dora_level') and comparison.WebTC.get('dora_level') %}
        <div class="card">
            <h2>üöÄ DORA Metrics Comparison</h2>
            <p class="helper-text">
                DevOps Research and Assessment (DORA) metrics measure software delivery performance based on industry benchmarks.
            </p>

            <!-- Performance Level Badges -->
            <div style="display: flex; gap: 20px; justify-content: center; margin: 30px 0;">
                <div class="dora-level-card" style="text-align: center; padding: 20px; background: var(--bg-secondary); border-radius: 12px; min-width: 200px;">
                    <h3>Native</h3>
                    <div class="dora-level-badge {{ comparison.Native.dora_level|lower }}" style="display: inline-block; padding: 8px 20px; border-radius: 8px; font-weight: bold; font-size: 1.1em; margin-top: 10px; text-transform: uppercase;">
                        {{ comparison.Native.dora_level }}
                    </div>
                </div>
                <div class="dora-level-card" style="text-align: center; padding: 20px; background: var(--bg-secondary); border-radius: 12px; min-width: 200px;">
                    <h3>WebTC</h3>
                    <div class="dora-level-badge {{ comparison.WebTC.dora_level|lower }}" style="display: inline-block; padding: 8px 20px; border-radius: 8px; font-weight: bold; font-size: 1.1em; margin-top: 10px; text-transform: uppercase;">
                        {{ comparison.WebTC.dora_level }}
                    </div>
                </div>
            </div>

            <!-- DORA Metrics Table -->
            <table>
                <thead>
                    <tr>
                        <th style="text-align: left;">DORA Metric</th>
                        <th class="team-native">Native</th>
                        <th class="team-webtc">WebTC</th>
                        <th>Difference</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Deployment Frequency -->
                    <tr>
                        <td>
                            <strong>Deployment Frequency</strong><br>
                            <small style="color: var(--text-secondary);">Deployments per week</small>
                        </td>
                        <td {% if comparison.Native.dora_deployment_freq > comparison.WebTC.dora_deployment_freq %}class="winner"{% endif %} style="text-align: center;">
                            <strong style="font-size: 1.3em;">{{ "%.1f"|format(comparison.Native.dora_deployment_freq) }}</strong>/week
                            <br><small style="color: var(--text-secondary);">({{ comparison.Native.dora_deployment_count }} total)</small>
                        </td>
                        <td {% if comparison.WebTC.dora_deployment_freq > comparison.Native.dora_deployment_freq %}class="winner"{% endif %} style="text-align: center;">
                            <strong style="font-size: 1.3em;">{{ "%.1f"|format(comparison.WebTC.dora_deployment_freq) }}</strong>/week
                            <br><small style="color: var(--text-secondary);">({{ comparison.WebTC.dora_deployment_count }} total)</small>
                        </td>
                        <td style="text-align: center;">
                            {% set diff = comparison.Native.dora_deployment_freq - comparison.WebTC.dora_deployment_freq %}
                            <span style="color: {% if diff > 0 %}#2ecc71{% elif diff < 0 %}#e74c3c{% else %}var(--text-primary){% endif %}; font-weight: bold;">
                                {% if diff > 0 %}+{% endif %}{{ "%.1f"|format(diff) }}
                            </span>
                        </td>
                    </tr>

                    <!-- Lead Time -->
                    <tr>
                        <td>
                            <strong>Lead Time for Changes</strong><br>
                            <small style="color: var(--text-secondary);">Median days from commit to production</small>
                        </td>
                        <td {% if comparison.Native.dora_lead_time < comparison.WebTC.dora_lead_time %}class="winner"{% endif %} style="text-align: center;">
                            <strong style="font-size: 1.3em;">{{ "%.1f"|format(comparison.Native.dora_lead_time) }}</strong> days
                        </td>
                        <td {% if comparison.WebTC.dora_lead_time < comparison.Native.dora_lead_time %}class="winner"{% endif %} style="text-align: center;">
                            <strong style="font-size: 1.3em;">{{ "%.1f"|format(comparison.WebTC.dora_lead_time) }}</strong> days
                        </td>
                        <td style="text-align: center;">
                            {% set diff = comparison.Native.dora_lead_time - comparison.WebTC.dora_lead_time %}
                            <span style="color: {% if diff < 0 %}#2ecc71{% elif diff > 0 %}#e74c3c{% else %}var(--text-primary){% endif %}; font-weight: bold;">
                                {% if diff > 0 %}+{% endif %}{{ "%.1f"|format(diff) }}
                            </span>
                        </td>
                    </tr>

                    <!-- Change Failure Rate -->
                    <tr>
                        <td>
                            <strong>Change Failure Rate</strong><br>
                            <small style="color: var(--text-secondary);">% of deployments causing incidents</small>
                        </td>
                        <td {% if comparison.Native.dora_cfr is not none and comparison.WebTC.dora_cfr is not none and comparison.Native.dora_cfr < comparison.WebTC.dora_cfr %}class="winner"{% endif %} style="text-align: center;">
                            {% if comparison.Native.dora_cfr is not none %}
                                <strong style="font-size: 1.3em;">{{ "%.1f"|format(comparison.Native.dora_cfr) }}%</strong>
                            {% else %}
                                <span style="color: var(--text-secondary);">N/A</span>
                            {% endif %}
                        </td>
                        <td {% if comparison.Native.dora_cfr is not none and comparison.WebTC.dora_cfr is not none and comparison.WebTC.dora_cfr < comparison.Native.dora_cfr %}class="winner"{% endif %} style="text-align: center;">
                            {% if comparison.WebTC.dora_cfr is not none %}
                                <strong style="font-size: 1.3em;">{{ "%.1f"|format(comparison.WebTC.dora_cfr) }}%</strong>
                            {% else %}
                                <span style="color: var(--text-secondary);">N/A</span>
                            {% endif %}
                        </td>
                        <td style="text-align: center;">
                            {% if comparison.Native.dora_cfr is not none and comparison.WebTC.dora_cfr is not none %}
                                {% set diff = comparison.Native.dora_cfr - comparison.WebTC.dora_cfr %}
                                <span style="color: {% if diff < 0 %}#2ecc71{% elif diff > 0 %}#e74c3c{% else %}var(--text-primary){% endif %}; font-weight: bold;">
                                    {% if diff > 0 %}+{% endif %}{{ "%.1f"|format(diff) }}%
                                </span>
                            {% else %}
                                <span style="color: var(--text-secondary);">-</span>
                            {% endif %}
                        </td>
                    </tr>

                    <!-- MTTR -->
                    <tr>
                        <td>
                            <strong>Mean Time to Recovery</strong><br>
                            <small style="color: var(--text-secondary);">Median days to resolve incidents</small>
                        </td>
                        <td {% if comparison.Native.dora_mttr is not none and comparison.WebTC.dora_mttr is not none and comparison.Native.dora_mttr < comparison.WebTC.dora_mttr %}class="winner"{% endif %} style="text-align: center;">
                            {% if comparison.Native.dora_mttr is not none %}
                                <strong style="font-size: 1.3em;">{{ "%.1f"|format(comparison.Native.dora_mttr) }}</strong> days
                            {% else %}
                                <span style="color: var(--text-secondary);">N/A</span>
                            {% endif %}
                        </td>
                        <td {% if comparison.Native.dora_mttr is not none and comparison.WebTC.dora_mttr is not none and comparison.WebTC.dora_mttr < comparison.Native.dora_mttr %}class="winner"{% endif %} style="text-align: center;">
                            {% if comparison.WebTC.dora_mttr is not none %}
                                <strong style="font-size: 1.3em;">{{ "%.1f"|format(comparison.WebTC.dora_mttr) }}</strong> days
                            {% else %}
                                <span style="color: var(--text-secondary);">N/A</span>
                            {% endif %}
                        </td>
                        <td style="text-align: center;">
                            {% if comparison.Native.dora_mttr is not none and comparison.WebTC.dora_mttr is not none %}
                                {% set diff = comparison.Native.dora_mttr - comparison.WebTC.dora_mttr %}
                                <span style="color: {% if diff < 0 %}#2ecc71{% elif diff > 0 %}#e74c3c{% else %}var(--text-primary){% endif %}; font-weight: bold;">
                                    {% if diff > 0 %}+{% endif %}{{ "%.1f"|format(diff) }}
                                </span>
                            {% else %}
                                <span style="color: var(--text-secondary);">-</span>
                            {% endif %}
                        </td>
                    </tr>
                </tbody>
            </table>

            <!-- DORA Explanation -->
            <div style="margin-top: 20px; padding: 15px; background: var(--bg-tertiary); border-radius: 8px;">
                <p><strong>About DORA Metrics:</strong> Industry-standard metrics measuring software delivery performance.</p>
                <p><strong>Performance Levels:</strong> Elite, High, Medium, Low based on industry benchmarks.</p>
                <p style="margin-top: 10px;"><small>üìä <strong>Higher is better:</strong> Deployment Frequency | <strong>Lower is better:</strong> Lead Time, Change Failure Rate, MTTR</small></p>
            </div>
        </div>
        {% endif %}

</div> <!-- End of comparison-container -->
{% endblock %}
